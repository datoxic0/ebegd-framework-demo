<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EBEGD Framework Demo</title>
    <link rel="stylesheet" href="style.css">
    <!-- Import Map for potential modules -->
    <script type="importmap">
        {
            "imports": {
                "nipplejs": "https://esm.sh/nipplejs"
            }
        }
    </script>
</head>
<body>

    <!-- Excel-like UI Container -->
    <div class="excel-app">
        
        <!-- Ribbon / Toolbar -->
        <div class="ribbon">
            <div class="menu-item active">File</div>
            <div class="menu-item">Home</div>
            <div class="menu-item" id="btn-insert-mode">Insert</div>
            <div class="menu-item">Page Layout</div>
            <div class="menu-item">Formulas</div>
            <div class="title">Novotek_Edu_Game_v1.xlsx - Excel</div>
        </div>

        <!-- Build Toolbar (New) -->
        <div id="build-toolbar" class="build-toolbar hidden">
            <div class="tool-label">BUILD TOOLS:</div>
            <div class="tool-btn" onclick="window.selectTool(1)">‚ñà Wall ($5)</div>
            <div class="tool-btn" onclick="window.selectTool(2)">üõèÔ∏è Dorm ($50)</div>
            <div class="tool-btn" onclick="window.selectTool(3)">üìö Lib ($100)</div>
            <div class="tool-btn" onclick="window.selectTool(4)">‚ö° Power ($150)</div>
            <div class="tool-btn" onclick="window.selectTool(0)">‚å´ Erase</div>
        </div>

        <!-- Formula Bar -->
        <div class="formula-bar-container">
            <div class="name-box" id="cell-address">A1</div>
            <div class="formula-icon">fx</div>
            <div class="formula-input" id="formula-display">=INIT_GAME()</div>
        </div>

        <!-- Simulation HUD -->
        <div class="sim-hud">
            <div class="hud-item">
                <span class="hud-label">CREDITS:</span>
                <span id="res-credits">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">KNOWLEDGE:</span>
                <span id="res-knowledge">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">ENERGY:</span>
                <span id="res-energy">100%</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">MODE:</span>
                <select id="game-mode-select" onchange="window.setMode(this.value)">
                    <option value="PLAY">PLAY (Student)</option>
                    <option value="BUILD">BUILD (Architect)</option>
                </select>
            </div>
        </div>

        <!-- The Canvas (Game Grid) -->
        <div class="spreadsheet-container" id="game-container">
            <!-- Headers and Grid will be generated by JS -->
            <div class="corner-header"></div>
            <div class="col-headers" id="col-headers"></div>
            <div class="row-headers" id="row-headers"></div>
            <div class="grid-viewport" id="grid-viewport">
                <div class="grid-canvas" id="grid-canvas"></div>
            </div>
        </div>

        <!-- Sheet Tabs -->
        <div class="sheet-tabs">
            <div class="tab active" onclick="switchTab('game')">Sheet1 (Game)</div>
            <div class="tab" onclick="switchTab('analytics')">Sheet2 (Analytics)</div>
            <div class="tab-add">+</div>
        </div>
    </div>

    <!-- Analytics Overlay (Hidden by default) -->
    <div id="analytics-panel" class="analytics-panel hidden">
        <h2>Backend_Analytics</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <h3>Moves</h3>
                <span id="stat-moves">0</span>
            </div>
            <div class="stat-box">
                <h3>Accuracy</h3>
                <span id="stat-accuracy">100%</span>
            </div>
            <div class="stat-box">
                <h3>Score</h3>
                <span id="stat-score">0</span>
            </div>
        </div>
        <div class="log-console" id="audit-log">
            <p>> System Initialized...</p>
        </div>
    </div>

    <!-- Pedagogical Modal (Question Popup) -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-window">
            <div class="modal-header">
                Function Argument
                <span class="close-modal" id="close-modal">√ó</span>
            </div>
            <div class="modal-body">
                <p id="question-text">Solve for x:</p>
                <div class="input-group">
                    <label>=ANSWER(</label>
                    <input type="text" id="answer-input" placeholder="value" autocomplete="off">
                    <label>)</label>
                </div>
                <div class="feedback-msg" id="feedback-msg"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel">Cancel</button>
                <button class="btn-ok" id="btn-submit">OK</button>
            </div>
        </div>
    </div>

    <!-- Mobile Controls -->
    <div id="mobile-controls"></div>

    <script type="module" src="main.js"></script>
</body>
</html>